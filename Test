Here is exactly what you need:

âœ… Goal

When IBAN is invalid â†’ you want HTTP 400, with your standard ApiError format, e.g.:

{
  "status": "BAD_REQUEST",
  "message": "Invalid IBAN format: ...",
  "errorCode": "OLKY_BAD_REQUEST",
  "timestamp": "2025-11-17T13:52:52.741061713"
}


â¸»

âœ… FIX

You simply need to add a handler for IbanFormatException BEFORE the generic Exception.class handler.

Your ExceptionHandler(Exception.class) currently catches it â†’ thatâ€™s why you get 500.

â¸»

âœ… Add this handler:

@ExceptionHandler(IbanFormatException.class)
public ResponseEntity<ApiError> handleIbanFormatException(IbanFormatException ex) {
    ApiError apiError = new ApiError(
            HttpStatus.BAD_REQUEST,
            ex.getMessage(),
            "OLKY_BAD_REQUEST"
    );
    return new ResponseEntity<>(apiError, apiError.getStatus());
}


â¸»

ðŸ›  Full Updated ControllerAdvice

@ControllerAdvice
public class GlobalExceptionHandler {

    @ExceptionHandler(OlkyException.class)
    public ResponseEntity<Map<String, String>> handleOlkyException(OlkyException e) {
        Map<String, String> errorResponse = new HashMap<>();
        errorResponse.put("error", e.getMessage());
        errorResponse.put("code", e.getErrorCode());
        return ResponseEntity.status(500).body(errorResponse);
    }

    @ExceptionHandler(BankNotFoundException.class)
    public ResponseEntity<ApiError> handleBankNotFoundException(BankNotFoundException ex) {
        ApiError apiError = new ApiError(HttpStatus.NOT_FOUND, ex.getMessage(), ex.getErrorCode());
        return new ResponseEntity<>(apiError, apiError.getStatus());
    }

    @ExceptionHandler(ExternalServiceException.class)
    public ResponseEntity<ApiError> handleExternalServiceException(ExternalServiceException ex) {
        ApiError apiError = new ApiError(HttpStatus.SERVICE_UNAVAILABLE, ex.getMessage(), ex.getErrorCode());
        return new ResponseEntity<>(apiError, apiError.getStatus());
    }

    // âœ… THIS FIXES YOUR PROBLEM
    @ExceptionHandler(IbanFormatException.class)
    public ResponseEntity<ApiError> handleIbanFormatException(IbanFormatException ex) {
        ApiError apiError = new ApiError(
                HttpStatus.BAD_REQUEST,
                ex.getMessage(),
                "OLKY_BAD_REQUEST"
        );
        return new ResponseEntity<>(apiError, apiError.getStatus());
    }

    @ExceptionHandler(Exception.class)
    public ResponseEntity<ApiError> handleGeneralException(Exception ex) {
        ApiError apiError = new ApiError(
                HttpStatus.INTERNAL_SERVER_ERROR,
                ex.getMessage(),
                "OLKY_INTERNAL_SERVER_ERROR"
        );
        return new ResponseEntity<>(apiError, apiError.getStatus());
    }
}


â¸»

ðŸŽ‰ Result

Invalid IBAN (bad format) now returns:

HTTP 400 BAD REQUEST

{
  "status": "BAD_REQUEST",
  "message": "Invalid IBAN format: DE123...",
  "errorCode": "OLKY_BAD_REQUEST",
  "timestamp": "2025-11-17T13:52:52.741061713"
}


â¸»

If you want, I can also help you define a cleaner ApiError class or unify all exception responses.