To make invalid IBAN format errors return HTTP 400 instead of HTTP 500, you must handle IbanFormatException with a @ControllerAdvice (or equivalent exception handler).

Right now, your service method throws IbanFormatException, which is not caught, so Spring treats it as an unhandled exception ‚Üí 500 Internal Server Error.

Below is the correct way to ensure the response becomes:

{
  "IbanFormatException": {
    "message": "[25050180000019880] length is 17, expected BBAN length is: 18"
  }
}

with HTTP 400.

‚∏ª

‚úÖ Step 1 ‚Äî Create an Exception Handler

@RestControllerAdvice
public class GlobalExceptionHandler {

    @ExceptionHandler(IbanFormatException.class)
    public ResponseEntity<Object> handleIbanFormatException(IbanFormatException ex) {

        Map<String, Object> errorBody = new HashMap<>();
        Map<String, String> details = new HashMap<>();

        details.put("message", ex.getMessage());
        errorBody.put("IbanFormatException", details);

        return ResponseEntity
                .status(HttpStatus.BAD_REQUEST)
                .body(errorBody);
    }
}

‚úî This ensures all thrown IbanFormatException return 400
‚úî Response body matches your required JSON structure

‚∏ª

‚úÖ Step 2 ‚Äî Keep Your Service Code As-Is

Your method can stay unchanged:

if (ibanValue == null) {
    throw new IbanFormatException("Invalid IBAN format: " + iban);
}

Spring will now route the exception to your handler.

‚∏ª

‚ùó Important Note

If your IbanFormatException is currently unchecked (extends RuntimeException) or checked ‚Äî both will work. Just ensure it‚Äôs not annotated with @ResponseStatus, otherwise it overrides the handler.

‚∏ª

üëç Final Result

Invalid IBAN ‚Üí throws exception ‚Üí caught ‚Üí client receives:

HTTP 400 Bad Request

{
  "IbanFormatException": {
    "message": "[25050180000019880] length is 17, expected BBAN length is: 18"
  }
}


‚∏ª

If you want, I can also help you improve the error structure or integrate this with Spring Validation.