Got it âœ… â€” you want your REST endpoint to return the full DTO response from the service instead of just "INVALID_IBAN", even when the IBAN is invalid or not found.

Right now, your controller always returns "INVALID_IBAN" if the Optional is empty or if an exception occurs â€” thatâ€™s why you never get the serviceâ€™s actual response body.

Letâ€™s fix that.

â¸»

âœ… Hereâ€™s the corrected version of your controller method:

@Operation(summary = "Validate Iban")
@ApiResponses(value = {
        @ApiResponse(responseCode = "200", description = "Validation completed",
                content = @Content(schema = @Schema(implementation = IbanSearchHistoryDTO.class))),
        @ApiResponse(responseCode = "400", description = "Invalid IBAN", content = @Content)
})
@PostMapping("/validate/{iban}")
public ResponseEntity<?> validateIban(@PathVariable String iban) {
    try {
        Optional<IbanSearchHistoryDTO> result = bankInfoValidationService.validateIban(iban);

        // âœ… If the service returned a DTO, return it with HTTP 200
        if (result.isPresent()) {
            return ResponseEntity.ok(result.get());
        }

        // âœ… If the IBAN is not valid but no exception occurred, return a meaningful response
        IbanSearchHistoryDTO invalidDto = new IbanSearchHistoryDTO();
        invalidDto.setIban(iban);
        invalidDto.setResult("INVALID");
        return ResponseEntity.status(HttpStatus.OK).body(invalidDto);

    } catch (IbanFormatException e) {
        // âœ… Return a structured error instead of plain text
        IbanSearchHistoryDTO errorDto = new IbanSearchHistoryDTO();
        errorDto.setIban(iban);
        errorDto.setResult("INVALID_FORMAT");
        return ResponseEntity.status(HttpStatus.BAD_REQUEST).body(errorDto);
    } catch (Exception e) {
        // Optional: catch any unexpected errors
        return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR)
                .body("Error while validating IBAN: " + e.getMessage());
    }
}


â¸»

ðŸ§© What Changed
	â€¢	You now return the actual DTO (IbanSearchHistoryDTO) from your service instead of just a plain string.
	â€¢	Invalid or missing IBANs still produce a response body, but now itâ€™s structured and consistent.
	â€¢	You still handle format errors cleanly with proper HTTP status codes.

â¸»

ðŸ§  Optional improvement

You can also make the service method return the DTO directly (instead of Optional<IbanSearchHistoryDTO>), with a result field always set to "VALID" or "INVALID". That simplifies controller logic even more.

Would you like me to show that cleaner version (service + controller refactored to always return a DTO)?