@PostMapping("/validate/{iban}")
public ResponseEntity<?> validateIban(@PathVariable String iban) {
    try {
        Optional<IbanSearchHistoryDTO> result = bankInfoValidationService.validateIban(iban);

        // ✅ If the service returned a result, return it
        if (result.isPresent()) {
            return ResponseEntity.ok(result.get());
        }

        // ✅ Otherwise, build your own response for invalid IBAN
        BankInfoValidationResponse response = new BankInfoValidationResponse();
        response.setIban(iban);
        response.setStatus("INVALID_IBAN");
        return ResponseEntity.status(HttpStatus.BAD_REQUEST).body(response);

    } catch (IbanFormatException e) {
        // ✅ Return a structured BAD REQUEST error
        BankInfoValidationResponse response = new BankInfoValidationResponse();
        response.setIban(iban);
        response.setStatus("INVALID_FORMAT");
        response.setMessage(e.getMessage());
        return ResponseEntity.status(HttpStatus.BAD_REQUEST).body(response);

    } catch (RuntimeException e) {
        // ✅ Generic fallback for unexpected errors
        BankInfoValidationResponse response = new BankInfoValidationResponse();
        response.setIban(iban);
        response.setStatus("ERROR");
        response.setMessage(e.getMessage());
        return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).body(response);
    }
}