Parfait üëç Tu veux donc un service Spring Boot qui g√©n√®re un avis de d√©bit (PDF) comme ton code existant, mais sans appel √† la base de donn√©es : tu veux simplement passer un objet contenant toutes les donn√©es n√©cessaires (client, fournisseur, montants, IBAN, etc.), et le service doit produire un PDF directement.

Voici un exemple complet, clair et optimis√© en Java (Spring Boot + Aspose/WOPI-like logique), structur√© de mani√®re professionnelle.

‚∏ª

üß© 1. DTO : Objet d‚Äôentr√©e pour g√©n√©rer le PDF

@Data
@NoArgsConstructor
@AllArgsConstructor
public class SctDebitData {
    private Integer orderId;
    private String txId;
    private String executionDate;
    private String endToEndId;
    private String outName;
    private String outAddress;
    private String outIban;
    private String supplierName;
    private String supplierIban;
    private String controlKey;
    private BigDecimal amount;
    private String label;
}

Cet objet contient tout ce dont ton PDF a besoin, sans d√©pendre de la base de donn√©es.

‚∏ª

üß† 2. Service : g√©n√©ration du PDF sans DB

@Service
public class SctDebitPdfGenerator {

    private static final Logger LOGGER = LoggerFactory.getLogger(SctDebitPdfGenerator.class);

    public byte[] generatePdf(SctDebitData data, InputStream template, int saveFormat) throws Exception {
        LOGGER.info("Generating SCT document for order <{}>", data.getOrderId());

        Document document = new Document(template);

        // üßæ Propri√©t√©s g√©n√©rales du document
        document.getBuiltInDocumentProperties().setTitle("Avis de d√©bit");
        document.getBuiltInDocumentProperties().setAuthor("Olkypay");
        document.getBuiltInDocumentProperties().setCompany("Olkypay");
        document.getBuiltInDocumentProperties().setKeywords(
                String.format("%s %s", data.getOrderId(), Optional.ofNullable(data.getTxId()).orElse(""))
        );

        // üîß Ajout des champs personnalis√©s
        CustomDocumentProperties cdp = document.getCustomDocumentProperties();
        setDocumentProperties(cdp, data);

        document.updateFields();

        ByteArrayOutputStream baos = new ByteArrayOutputStream();
        document.save(baos, saveFormat);
        return baos.toByteArray();
    }

    private void setDocumentProperties(CustomDocumentProperties cdp, SctDebitData data) {
        cdp.add("OrderId", data.getOrderId());
        cdp.add("ExecutionDate", data.getExecutionDate());
        cdp.add("OutName", data.getOutName());
        cdp.add("OutAddress", data.getOutAddress());
        cdp.add("OutIban", data.getOutIban());
        cdp.add("SupplierName", data.getSupplierName());
        cdp.add("SupplierIban", data.getSupplierIban());
        cdp.add("ControlKey", data.getControlKey());
        cdp.add("Amount", data.getAmount().toPlainString());
        cdp.add("Label", data.getLabel());
    }
}

‚úÖ Ici, aucune d√©pendance √† la DB. Tout vient de SctDebitData.
‚úÖ Compatible avec Aspose Words / PDF save format (Word ‚Üí PDF).

‚∏ª

üåê 3. Contr√¥leur REST

@RestController
@RequestMapping("/api/sct-debit")
public class SctDebitController {

    private static final Logger LOGGER = LoggerFactory.getLogger(SctDebitController.class);

    private final SctDebitPdfGenerator pdfGenerator;

    @Autowired
    public SctDebitController(SctDebitPdfGenerator pdfGenerator) {
        this.pdfGenerator = pdfGenerator;
    }

    @PostMapping(value = "/generate", produces = MediaType.APPLICATION_PDF_VALUE)
    public ResponseEntity<byte[]> generate(@RequestBody SctDebitData data) {
        try (InputStream template = getClass().getResourceAsStream("/templates/avis-debit-template.docx")) {
            byte[] pdf = pdfGenerator.generatePdf(data, template, SaveFormat.PDF);

            HttpHeaders headers = new HttpHeaders();
            headers.setContentType(MediaType.APPLICATION_PDF);
            String filename = String.format("Avis-debit-%d.pdf", data.getOrderId());
            headers.setContentDispositionFormData(filename, filename);
            headers.setCacheControl("must-revalidate, post-check=0, pre-check=0");

            LOGGER.info("PDF generated successfully for order <{}>", data.getOrderId());
            return new ResponseEntity<>(pdf, headers, HttpStatus.OK);
        } catch (Exception e) {
            LOGGER.error("Error generating SCT PDF", e);
            return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR)
                    .body(("Erreur lors de la g√©n√©ration : " + e.getMessage()).getBytes(StandardCharsets.UTF_8));
        }
    }
}


‚∏ª

üìÅ 4. Exemple de requ√™te API

POST http://localhost:8080/api/sct-debit/generate

{
  "orderId": 12345,
  "txId": "TX987654321",
  "executionDate": "2025-11-03",
  "endToEndId": "E2E12345",
  "outName": "Jean Dupont",
  "outAddress": "10 rue de la Paix, 75002 Paris",
  "outIban": "FR7612345987654321009876543",
  "supplierName": "Olkypay SARL",
  "supplierIban": "FR7610002000123456789012345",
  "controlKey": "ABC123",
  "amount": 250.75,
  "label": "Paiement facture 456"
}

üî• Le service renverra directement le PDF en r√©ponse (comme un t√©l√©chargement).

‚∏ª

‚öôÔ∏è 5. Points d‚Äôoptimisation
	‚Ä¢	‚úÖ Aucune d√©pendance DB : tout est inject√© via SctDebitData.
	‚Ä¢	‚úÖ R√©utilisable : tu peux appeler generatePdf() depuis d‚Äôautres services (API, batch‚Ä¶).
	‚Ä¢	‚úÖ Template flexible : ton mod√®le Word/PDF (avis-debit-template.docx) peut contenir des champs √† remplacer (MERGEFIELDS).
	‚Ä¢	‚úÖ Robuste : gestion des erreurs propre et r√©ponse HTTP coh√©rente.

‚∏ª

Souhaites-tu que je te montre une version qui remplit directement le template Word (avec les champs dynamiques) au lieu d‚Äôutiliser uniquement les propri√©t√©s personnalis√©es ?
Cela permettrait que ton fichier mod√®le contienne des tags du type ¬´ <<NomClient>> ¬ª, remplac√©s automatiquement avant export PDF.